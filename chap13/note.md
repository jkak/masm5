
# 第十三章

## int_7ch.asm
13.2的问题2：

使用int 7ch来实现对一个字符串的的大写转换。


## int_loop.asm
13.3　用int实现loop功能

使用int来实现loop的功能。其核心功能是在int处理例程中，先判断是否循环完，如果没有循环完，则需要修改IP的值，使程序跳转。

因此需要提供一个跳转的偏移量。程序中使用的BX。

刚进入中断例程时：

|     |
|-----|
| IP  | <---- SP
|-----|
| CS  |
|-----|
| PSW |
|-----|
|     |

为了修改堆栈的内容，因此需要使用SS:BP，故压栈BP。

|     |
|-----|
| BP  | <---- BP = SP
|-----|
| IP  | <---- (BP+2) modify IP, (ip)=(ip)+(bx)
|-----|
| CS  |
|-----|
| PSW |
|-----|
|     |


## int_jmp.asm
检测点13.1 -(2)　用int实现jmp功能

整体结构同上一程序int_loop.asm，故不需要多做说明。





## 启动过程

对于8086的启动过程。需要非常清楚几个关键点，此处做一个相对完整的整理，比书上要详细诸多：

### 上电初始化
* 上电，电源器等待输出的各3V, 5V, 12V电压稳定。稳定后电源输出“加电成功”信号给芯片，以此启动8284时钟发生器。
* CPU重新自设定为初始状态。
* CPU时钟稳定后，初始化完成。此时内存为空，但将CS:IP预设置为0FFFF:0H（ROM的最后16字节），此处地址可读不可见。通常放置一个jmp far指令跳转到 BIOS的startup program——POST。
* 
### BIOS工作
* 进入POST(Power-On Self Test)自检，包括各寄存器，芯片组控制器，键盘控制器等。
* 建立BIOS的中断向量表，地址为0-1K。但不需要加载中断例程，因为例程本来就在BIOS的ROM中。常用的中断有int13h读写磁盘，int10写屏幕，int16读键盘。
* 查找BIOS内部的显卡程序，初始化显卡。通常在C0000H地址。
* 查找其他设置的BIOS程序，如硬盘在c8000h，检测内存，pnp等。以上检测会将数据放置在1K-2K的RAM区，即BIOS Data Area.
* Setup，即可以进入BIOS设置（即del或F2进入的设置界面），设置内存存储在CMOS中。这是由电池供电的一小区RAM区，其前12字节是计算机时间。
* 读取CMOS中的启动顺序配置，检查启动装置是否正常。
* 初始化程序调用**int 19h**进行系统自举。

### 加载MBR
* int 19h加载MBR。根据CMOS中保存的启动设备顺序，读取启动盘的第一个扇区(Cylinder 0, Header 0, Sector 1)到7c00h地址。
* 该扇区称为MBR(Master Boot Record)。MBR共512字节，前446是主引导程序，后64字节是4个磁盘分区表，最后2字节是0xAA55H，表示此扇区是MBR。
* int 19h将MBR中的引导程序复制到内存的7c00h地址。并跳转到该处执行，此时权限已经由硬件转到OS启动阶段。



